if("undefined"===typeof RELANG)var RELANG={};
var RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",
_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",
file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",fullscreen:"Fullscreen",deleted:"Deleted",anchor:"Anchor"};
(function(b){jQuery.fn.redactor=function(a){return this.each(function(){var c=b(this);c.data("redactor")||c.data("redactor",new i(this,a))})};var i=function(a,c){this.$el=b(a);"undefined"!==typeof c&&("undefined"!==typeof c.lang&&"en"!==c.lang&&"undefined"!==typeof RELANG[c.lang])&&(RLANG=RELANG[c.lang]);this.opts=b.extend({lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,path:!1,css:"style.css",focus:!1,resize:!0,autoresize:!1,fixed:!1,autoformat:!0,
cleanUp:!0,removeStyles:!1,removeClasses:!1,convertDivs:!0,convertLinks:!0,xhtml:!1,handler:!1,autosave:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,fileUpload:!1,fileUploadCallback:!1,observeImages:!0,visual:!0,fullscreen:!1,overlay:!0,buttonsCustom:{},buttonsAdd:[],buttons:"html | formatting | bold italic deleted | unorderedlist orderedlist outdent indent | image video file table link | fontcolor backcolor | alignleft aligncenter alignright justify | horizontalrule fullscreen".split(" "),
colors:"#ffffff #000000 #eeece1 #1f497d #4f81bd #c0504d #9bbb59 #8064a2 #4bacc6 #f79646 #ffff00 #f2f2f2 #7f7f7f #ddd9c3 #c6d9f0 #dbe5f1 #f2dcdb #ebf1dd #e5e0ec #dbeef3 #fdeada #fff2ca #d8d8d8 #595959 #c4bd97 #8db3e2 #b8cce4 #e5b9b7 #d7e3bc #ccc1d9 #b7dde8 #fbd5b5 #ffe694 #bfbfbf #3f3f3f #938953 #548dd4 #95b3d7 #d99694 #c3d69b #b2a2c7 #b7dde8 #fac08f #f2c314 #a5a5a5 #262626 #494429 #17365d #366092 #953734 #76923c #5f497a #92cddc #e36c09 #c09100 #7f7f7f #0c0c0c #1d1b10 #0f243e #244061 #632423 #4f6128 #3f3151 #31859b #974806 #7f6000".split(" "),
allEmptyHtml:"<p><br /></p>",mozillaEmptyHtml:"<p>&nbsp;</p>",modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form>',modal_image_edit:String()+"<label>"+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+
RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'</a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+
RLANG.cancel+"</a></span></div>",modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+
RLANG.image_web_link+'</label><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+
RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+
RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_table:String()+"<label>"+RLANG.rows+'</label><input size="5" value="2" id="redactor_table_rows" /><label>'+
RLANG.columns+'</label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",modal_video:String()+'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+
RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"</a></span></div>",toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},
h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},
outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},
insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},
link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule},
fullscreen:{title:RLANG.fullscreen,func:"fullscreen"}}},c,this.$el.data());this.dropdowns=[];this.init()};i.prototype={init:function(){this.getPath();!1!==this.opts.toolbar&&(b.extend(this.opts.toolbar,this.opts.buttonsCustom),b.each(this.opts.buttonsAdd,b.proxy(function(a,b){this.opts.buttons.push(b)},this)));this.height=this.$el.css("height");this.width=this.$el.css("width");this.build();var a=this.$el.val(),a=this.preformater(a);this.opts.autoformat&&(a=this.paragraphy(a));this.$editor=this.enable(a);
this.observeFocus();!0===this.opts.cleanUp&&b(this.doc).bind("paste",b.proxy(function(){setTimeout(b.proxy(function(){var a=Math.floor(99999*Math.random()),d="";b.browser.mozilla&&(d="&nbsp;");d=b('<span rel="pastemarkerend" id="pastemarkerend'+a+'">'+d+"</span>");this.insertNodeAtCaret(d.get(0));this.pasteCleanUp(a)},this),100)},this));b(this.doc).keyup(b.proxy(function(a){var b=a.keyCode||a.which;"function"===typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,a);if(this.opts.autoformat){if(8===
b||46===b)return this.formatEmpty(a);if(13===b&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey)return this.formatNewLine(a)}this.syncCode()},this));this.buildToolbar();!1===this.opts.autoresize?this.buildResizer():this.observeAutoResize();this.shortcuts();this.autoSave();this.observeImages();this.observeTables();this.opts.fullscreen&&(this.opts.fullscreen=!1,this.fullscreen());this.opts.focus&&this.focus();this.opts.fixed&&(this.observeScroll(),b(document).scroll(b.proxy(this.observeScroll,this)));"function"===
typeof this.opts.callback&&this.opts.callback(this)},shortcuts:function(){b(this.doc).keydown(b.proxy(function(a){var c=a.keyCode||a.which;"function"===typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,a);a.ctrlKey&&(90===c?this._shortcuts(a,"undo"):90===c&&a.shiftKey?this._shortcuts(a,"redo"):77===c?this._shortcuts(a,"removeFormat"):66===c?this._shortcuts(a,"bold"):73===c?this._shortcuts(a,"italic"):74===c?this._shortcuts(a,"insertunorderedlist"):75===c?this._shortcuts(a,"insertorderedlist"):
76===c?this._shortcuts(a,"superscript"):72===c&&this._shortcuts(a,"subscript"));!a.shiftKey&&9===c?this._shortcuts(a,"indent"):a.shiftKey&&9===c&&this._shortcuts(a,"outdent");if(b.browser.webkit&&-1===navigator.userAgent.indexOf("Chrome"))return this.safariShiftKeyEnter(a,c)},this))},_shortcuts:function(a,b){a.preventDefault&&a.preventDefault();this.execCommand(b,!1)},getPath:function(){if(!1!==this.opts.path)return this.opts.path;b("script").each(b.proxy(function(a,b){if(b.src){var d=RegExp(/\/redactor(\.min)?\.js(\?.*)?/);
b.src.match(d)&&(this.opts.path=b.src.replace(d,""))}},this))},build:function(){this.$box=b('<div class="redactor_box"></div>');this.$frame=b('<iframe frameborder="0" scrolling="auto" style="height: '+this.height+';" class="redactor_frame"></iframe>');this.$el.css("width","100%").hide();this.$box.insertAfter(this.$el).append(this.$frame).append(this.$el)},write:function(a){this.doc.open();this.doc.write(a);this.doc.close()},enable:function(a){this.doc=this.getDoc(this.$frame.get(0));return null!==
this.doc?(this.write(this.setDoc(a)),b(this.doc).find("#page")):!1},setDoc:function(a){return'<!DOCTYPE html>\n<html><head><link media="all" type="text/css" href="'+this.opts.css+'" rel="stylesheet"></head><body><div id="page" contenteditable="true" dir="'+this.opts.direction+'">'+a+"</div></body></html>"},getDoc:function(a){return a.contentDocument?a.contentDocument:a.contentWindow&&a.contentWindow.document?a.contentWindow.document:a.document?a.document:null},focus:function(){this.$editor.focus()},
syncCode:function(){var a=this.formatting(this.$editor.html());this.$el.val(a)},setCode:function(a){a=this.preformater(a);this.$editor.html(a).focus();this.syncCode()},getCode:function(){var a=this.$editor?this.$editor.html():this.$el.val();return a=this.reformater(a)},insertHtml:function(a){this.execCommand("inserthtml",a);this.observeImages()},destroy:function(){var a=this.getCode();this.$box.after(this.$el);this.$box.remove();this.$el.val(a).show();for(a=0;a<this.dropdowns.length;a++)this.dropdowns[a].remove(),
delete this.dropdowns[a]},handler:function(){b.ajax({url:this.opts.handler,type:"POST",data:"redactor="+escape(encodeURIComponent(this.getCode())),success:b.proxy(function(a){this.setCode(a);this.syncCode()},this)})},observeFocus:function(){if(b.browser.msie)return!1;b(this.doc).find("body").height()<b(this.$frame.get(0).contentWindow).height()&&b(this.doc).click(b.proxy(function(){this.$editor.focus()},this))},observeImages:function(){if(!1===this.opts.observeImages)return!1;b(this.doc).find("img").each(b.proxy(function(a,
c){b.browser.msie&&b(c).attr("unselectable","on");this.resizeImage(c)},this))},observeTables:function(){b(this.doc).find("body").find("table").click(b.proxy(this.tableObserver,this))},observeScroll:function(){var a=b(document).scrollTop(),c=this.$box.offset().top;a>c?(this.fixed=!0,this.$toolbar.css({position:"fixed",width:"100%"})):(this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto"}))},observeAutoResize:function(){this.$editor.css({"min-height":this.$el.height()+"px"});b(this.doc).find("body").css({overflow:"hidden"});
this.setAutoSize(!1);b(this.doc).keyup(b.proxy(this.setAutoSize,this))},setAutoSize:function(a){var b=!1;!1!==a&&(b=a.keyCode||a.which);var d=this.$editor.outerHeight(!0);!0===a&&(8===b||46===b)?this.$frame.height(d):this.$frame.height(d+30)},execCommand:function(a,c){if(this.opts.visual&&this.doc)try{b.browser.msie&&this.focus(),"inserthtml"===a&&b.browser.msie?this.doc.selection.createRange().pasteHTML(c):"formatblock"===a&&b.browser.msie?this.doc.execCommand(a,!1,"<"+c+">"):this.doc.execCommand(a,
!1,c),this.syncCode(),this.focus(),"function"===typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,a)}catch(d){}},formatNewLine:function(a){var c=this.getParentNode();if("DIV"===c.nodeName&&"page"===c.id){a.preventDefault&&a.preventDefault();a=b(this.getCurrentNode());if("DIV"===a.get(0).tagName&&(""===a.html()||"<br>"===a.html()))return c=b("<p>").append(a.clone().get(0).childNodes),a.replaceWith(c),c.html("<br />"),this.setFocusNode(c.get(0)),this.syncCode(),!1;this.syncCode();
this.opts.convertLinks&&this.$editor.linkify()}else return this.syncCode(),!0},safariShiftKeyEnter:function(a,c){if(a.shiftKey&&13===c){a.preventDefault();var d=b("<span><br /></span>");this.insertNodeAtCaret(d.get(0));this.setFocusNode(d.get(0));this.syncCode();return!1}return!0},formatEmpty:function(a){var c=b.trim(this.$editor.html());b.browser.mozilla&&(c=c.replace(/<br>/gi,""));if(""===c)return a.preventDefault&&a.preventDefault(),a=this.opts.allEmptyHtml,b.browser.mozilla&&(a=this.opts.mozillaEmptyHtml),
a=b(a).get(0),this.$editor.html(a),this.setFocusNode(a),this.syncCode(),!1;this.syncCode()},paragraphy:function(a){a=b.trim(a);if(""===a)return b.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;this.opts.convertDivs&&(a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var c=function(a,b,c){return a.replace(RegExp(b,"g"),c)},d=function(b,d){return c(a,b,d)},a=a+"\n";d("<br />\\s*<br />","\n\n");d("(<(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)",
"\n$1");d("(</(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])>)","$1\n\n");d("\r\n|\r","\n");d("\n\n+","\n\n");d("\n?((.|\n)+?)$","<p>$1</p>\n");d("<p>\\s*?</p>","");d("<p>(<div[^>]*>\\s*)","$1<p>");d("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");d("<p>\\s*(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*</p>",
"$1");d("<p>(<li.+?)</p>","$1");d("<p>\\s*(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)","$1");d("(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*</p>","$1");d("(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*<br />",
"$1");d("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");-1!=a.indexOf("<pre")&&d("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(a,b,d,h){return c(b,"\\\\(['\"\\\\])","$1")+c(c(c(h,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"});return d("\n</p>$","</p>")},preformater:function(a){null!==a?(a=a.replace(/<br>/gi,"<br />"),a=a.replace(/<strong\b[^>]*>([\w\W]*?)<\/strong[^>]*>/gi,"<b>$1</b>"),a=a.replace(/<em\b[^>]*>([\w\W]*?)<\/em[^>]*>/gi,"<i>$1</i>"),a=a.replace(/<del\b[^>]*>([\w\W]*?)<\/del[^>]*>/gi,
"<strike>$1</strike>")):a="";return a},reformater:function(a){a=a.replace(/<br>/gi,"<br />");a=a.replace(/<b\b[^>]*>([\w\W]*?)<\/b[^>]*>/gi,"<strong>$1</strong>");a=a.replace(/<i\b[^>]*>([\w\W]*?)<\/i[^>]*>/gi,"<em>$1</em>");a=a.replace(/<strike\b[^>]*>([\w\W]*?)<\/strike[^>]*>/gi,"<del>$1</del>");a=a.replace(/<span(.*?)style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong>$2</strong>");a=a.replace(/<span(.*?)style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<em>$2</em>");a=a.replace(/<span(.*?)style="font-weight: bold; font-style: italic;">([\w\W]*?)<\/span>/gi,
"<em><strong>$2</strong></em>");return a=a.replace(/<span(.*?)style="font-style: italic; font-weight: bold;">([\w\W]*?)<\/span>/gi,"<strong><em>$2</em></strong>")},stripTags:function(a){var c="code span div label a br p b i del strike img video audio iframe object embed param blockquote mark cite small ul ol li hr dl dt dd sup sub big pre code figure figcaption strong em table tr td th tbody thead tfoot h1 h2 h3 h4 h5 h6".split(" ");return a.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,e){return"-1"<
b.inArray(e.toLowerCase(),c)?a:""})},cleanStyles:function(a,c,d){var e=d.split("=")[1].split(";"),f="";b.each(e,function(c,d){if("undefined"==typeof d||'"'==d||"'"==d)return!0;var d=d.replace(/(^"|^')/,"").replace(/("$|'$)/,"").replace(/"(.*?)"/gi,""),d=b.trim(d),e=d.split(":");"undefined"!==typeof e[1]&&-1===e[1].search("pt")&&-1===e[1].search("cm")&&"-1"!=b.inArray(b.trim(e[0]),a)&&(f+=d+"; ")});return c.replace(d,'style="'+f+'"')},pasteCleanUp:function(a){var c=this.$editor.html(),c=c.replace(/<\!--[\s\S]*?--\>|<\?(?:php)?[\s\S]*?\?>/gi,
""),c=this.formattingRemove(c),c=this.stripTags(c);this.opts.removeClasses?c=c.replace(/ class="([\w\W]*?)"/gi,""):(c=c.replace(/\s*class="TOC(.*?)"/gi,""),c=c.replace(/\s*class="Heading(.*?)"/gi,""),c=c.replace(/\s*class="Body(.*?)"/gi,""),c=c.replace(/\sclass="Nonformat"/gi,""),c=c.replace(/\sclass="Mso(.*?)"/gi,""),c=c.replace(/\sclass="Apple(.*?)"/gi,""),c=c.replace(/"Times New Roman"/gi,""));var d="width height src style href frameborder class id rel unselectable".split(" "),e="color background-color font-style margin margin-top margin-bottom margin-left margin-right text-align width height cursor float".split(" "),
f=c.match(/([\w\-.:]+)\s*=\s*("[^"]*"|'[^']*'|[\w\-.:]+)/gi);b.each(f,b.proxy(function(a,f){var j=f.split("=");"-1"==b.inArray(j[0],d)&&(c=c.replace(f,""));!1===this.opts.removeStyles&&"style"==j[0]&&(c=this.cleanStyles(e,c,f))},this));!1===this.opts.removeStyles?(c=c.replace(/background-color:(\s+)transparent;\s/gi,""),c=c.replace(/font-style:(\s+)normal;\s/gi,"")):c=c.replace(/ style="([\w\W]*?)"/gi,"");c=c.replace(/((\s{2,})?|\s)style=(""|'')/gi,"");c=c.replace(/(&nbsp;){1,}/gi,"&nbsp;");c=c.replace(/<span(\s)?>(\s)?<\/span>/gi,
" ");c=c.replace(/\s{2,}/g," ");c=c.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");c=c.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");c=c.replace(/<span(\s)?>([\w\W]*?)<\/span>/gi,"$2");c=this.formattingEmptyTags(c);c=this.formattingAddBefore(c);c=this.formattingAddAfter(c);c=this.formattingIndenting(c);c=c.replace(/<p><div>/gi,"");c=c.replace(/<p>\s+\n+<(.*?)/gi,"<$1");c=c.replace(/<\/(.*?)>\s+\n+<\/p>/gi,"</$1>");c=c.replace(/<p style="(.*?)">(\s)?<\/p>/gi,"");c=c.replace(/<p style="(.*?)"><\/p>/gi,"");
c=c.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");c=c.replace(/; ">/gi,';">');this.$editor.html(c);a=b(this.doc.body).find("#pastemarkerend"+a).get(0);this.setFocusNode(a);this.syncCode();setTimeout(b.proxy(function(){b(this.doc.body).find("span[rel=pastemarkerend]").remove();!0===this.opts.autoresize&&this.setAutoSize(!1);this.observeImages();this.observeTables()},this),100)},formattingRemove:function(a){a=a.replace(/\s{2,}/g," ");a=a.replace(/\n/g," ");a=a.replace(/[\t]*/g,
"");a=a.replace(/\n\s*\n/g,"\n");a=a.replace(/^[\s\n]*/g,"");a=a.replace(/[\s\n]*$/g,"");return a=a.replace(/>\s+</g,"><")},formattingIndenting:function(a){a=a.replace(/<li/g,"\t<li");a=a.replace(/<tr/g,"\t<tr");a=a.replace(/<td/g,"\t\t<td");return a=a.replace(/<\/tr>/g,"\t</tr>")},formattingEmptyTags:function(a){for(var b="<pre></pre> <blockquote>\\s*</blockquote> <em>\\s*</em> <ul></ul> <ol></ol> <li></li> <table></table> <tr></tr> <span>\\s*<span> <span>&nbsp;<span> <b>\\s*</b> <b>&nbsp;</b> <p>\\s*</p> <p>&nbsp;</p> <p>\\s*<br>\\s*</p> <div>\\s*</div> <div>\\s*<br>\\s*</div>".split(" "),
d=0;d<b.length;++d)a=a.replace(RegExp(b[d],"gi"),"");return a},formattingAddBefore:function(a){for(var b="<p <form </ul> </ol> <fieldset <legend <object <embed <select <option <input <textarea <pre <blockquote <ul <ol <li <dl <dt <dd <table <thead <tbody <caption </caption> <th <tr <td <figure".split(" "),d=0;d<b.length;++d)var e=b[d],a=a.replace(RegExp(e,"gi"),"\r\n"+e);return a},formattingAddAfter:function(a){for(var b="</p>;</div>;</h1>;</h2>;</h3>;</h4>;</h5>;</h6>;<br>;<br />;</dl>;</dt>;</dd>;</form>;</blockquote>;</pre>;</legend>;</fieldset>;</object>;</embed>;</textarea>;</select>;</option>;</table>;</thead>;</tbody>;</tr>;</td>;</th>;</figure>".split(";"),
d=0;d<b.length;++d)var e=b[d],a=a.replace(RegExp(e,"gi"),e+"\r\n");return a},formatting:function(a){if(b.browser.msie){var c=a.match(/<(.*?)>/gi);b.each(c,function(b,c){a=a.replace(c,c.toLowerCase())});a=a.replace(/style="(.*?)"/gi,function(a){return a.toLowerCase()});a=a.replace(/ jQuery(.*?)=\"(.*?)\"/gi,"")}a=a.replace(/<span([\w\W]*?)style="color:(.*?);"><span([\w\W]*?)style="background-color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,'<span style="color: $2; background-color: $4;">$5</span>');a=a.replace(/<span([\w\W]*?)style="background-color:(.*?);"><span([\w\W]*?)style="color:(.*?);">([\w\W]*?)<\/span><\/span>/gi,
'<span style="color: $2; background-color: $4;">$5</span>');a=a.replace(/<span([\w\W]*?)color="(.*?)">([\w\W]*?)<\/span\>/gi,'<span$1style="color: $2;">$3</span>');a=a.replace(/<font([\w\W]*?)color="(.*?)">([\w\W]*?)<\/font\>/gi,'<span$1style="color: $2;">$3</span>');a=a.replace(/<span style="(.*?)"\s+style="(.*?)"[\s]*>([\w\W]*?)<\/span\>/gi,'<span style="$1;$2">$3</span>');a=a.replace(/<font([\w\W]*?)>([\w\W]*?)<\/font\>/gi,"<span$1>$2</span>");a=a.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");this.opts.xhtml&&
(a=a.replace(/<br>/gi,"<br />"),a=a.replace(/<br ?\/?>$/gi,""),a=a.replace(/^<br ?\/?>/gi,""),a=a.replace(/(<img [^>]+[^\/])>/gi,"$1 />"));a=a.replace(/<p><p>/g,"<p>");a=a.replace(/<\/p><\/p>/g,"</p>");a=a.replace(/<hr(.*?)>/g,"<hr />");a=a.replace(/<p>&nbsp;/g,"<p>");a=a.replace(/<p><ul>/g,"<ul>");a=a.replace(/<p><ol>/g,"<ol>");a=a.replace(/<\/ul><\/p>/g,"</ul>");a=a.replace(/<\/ol><\/p>/g,"</ol>");a=a.replace(/<p(.*?)>&nbsp;<\/p>/gi,"");a=this.formattingRemove(a);a=this.formattingEmptyTags(a);a=
this.formattingAddBefore(a);a=this.formattingAddAfter(a);return a=this.formattingIndenting(a)},toggle:function(){var a;this.opts.visual?(this.$frame.hide(),a=this.$editor.html(),a=b.trim(this.formatting(a)),this.$el.val(a).show().focus(),this.setBtnActive("html"),this.opts.visual=!1):(this.$el.hide(),this.$editor.html(this.$el.val()),this.$frame.show(),""===this.$editor.html()&&(a=b.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml,this.setCode(a)),this.focus(),this.setBtnInactive("html"),
this.opts.visual=!0,this.observeImages(),this.observeTables(),!0===this.opts.autoresize&&this.setAutoSize(!1))},autoSave:function(){if(!1===this.opts.autosave)return!1;setInterval(b.proxy(function(){b.post(this.opts.autosave,{data:this.getCode()})},this),1E3*this.opts.interval)},buildToolbar:function(){if(!1===this.opts.toolbar)return!1;this.$toolbar=b("<ul>").addClass("redactor_toolbar");this.$box.prepend(this.$toolbar);b.each(this.opts.buttons,b.proxy(function(a,c){if("|"!==c&&"undefined"!==typeof this.opts.toolbar[c]){var d=
this.opts.toolbar[c];if(!1===this.opts.fileUpload&&"file"===c)return!0;var e=b("<li>");"fullscreen"===c&&b(e).addClass("redactor_toolbar_right");var f=this.buildButton(c,d);if("backcolor"===c||"fontcolor"===c||"undefined"!==typeof d.dropdown){var g=b('<div class="redactor_dropdown" style="display: none;">'),g="backcolor"===c||"fontcolor"===c?this.buildColorPicker(g,c):this.buildDropdown(g,d.dropdown);this.dropdowns.push(g.appendTo(b(document.body)));this.hdlHideDropDown=b.proxy(function(a){this.hideDropDown(a,
g,c)},this);this.hdlShowDropDown=b.proxy(function(a){this.showDropDown(a,g,c)},this);f.click(this.hdlShowDropDown)}this.$toolbar.append(b(e).append(f))}"|"===c&&this.$toolbar.append(b('<li class="redactor_separator"></li>'))},this));b(document).click(this.hdlHideDropDown);b(this.doc).click(this.hdlHideDropDown)},buildButton:function(a,c){var d=b('<a href="javascript:void(null);" title="'+c.title+'" class="redactor_btn_'+a+'"><span>&nbsp;</span></a>');"undefined"===typeof c.func?d.click(b.proxy(function(){this.execCommand(c.exec,
a)},this)):"show"!==c.func&&d.click(b.proxy(function(a){this[c.func](a)},this));"undefined"!==typeof c.callback&&d.click(b.proxy(function(b){c.callback(this,b,a)},this));return d},buildDropdown:function(a,c){b.each(c,b.proxy(function(c,e){"undefined"===typeof e.className&&(e.className="");var f;"undefined"!==typeof e.name&&"separator"===e.name?f=b('<a class="redactor_separator_drop">'):(f=b('<a href="javascript:void(null);" class="'+e.className+'">'+e.title+"</a>"),"undefined"===typeof e.func?b(f).click(b.proxy(function(){this.execCommand(e.exec,
c)},this)):b(f).click(b.proxy(function(a){this[e.func](a)},this)));b(a).append(f)},this));return a},buildColorPicker:function(a,c){var d;d="backcolor"===c?b.browser.msie?"BackColor":"hilitecolor":"forecolor";b(a).width(210);for(var e=this.opts.colors.length,f=0;f<e;++f){var g=this.opts.colors[f],g=b('<a rel="'+g+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:g});b(a).append(g);var h=this;b(g).click(function(){h.execCommand(d,b(this).attr("rel"))})}e=b('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);
"backcolor"===c?e.click(b.proxy(this.setBackgroundNone,this)):e.click(b.proxy(this.setColorNone,this));b(a).append(e);return a},setBackgroundNone:function(){b(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){b(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(a,c,d){this.getBtn(d).hasClass("dropact")?this.hideAllDropDown():(this.hideAllDropDown(),this.setBtnActive(d),this.getBtn(d).addClass("dropact"),
a=this.getBtn(d).offset().left,this.opts.fixed&&this.fixed?b(c).css({position:"fixed",left:a+"px",top:"30px"}).show():(d=this.$toolbar.offset().top+30,b(c).css({position:"absolute",left:a+"px",top:d+"px"}).show()))},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact");b(".redactor_dropdown").hide()},hideDropDown:function(a,c){b(a.target).parent().hasClass("dropact")||(b(c).removeClass("act"),this.showedDropDown=!1,this.hideAllDropDown())},getSelection:function(){if(this.$frame.get(0).contentWindow.getSelection)return this.$frame.get(0).contentWindow.getSelection();
if(this.$frame.get(0).contentWindow.document.selection)return this.$frame.get(0).contentWindow.document.selection.createRange()},getParentNode:function(){if(window.getSelection)return this.getSelection().getRangeAt(0).startContainer.parentNode;if(document.selection)return this.getSelection().parentElement()},getCurrentNode:function(){if(window.getSelection)return this.getSelection().getRangeAt(0).startContainer;if(document.selection)return this.getSelection()},setFocusNode:function(a,b){var d=this.doc.createRange(),
e=this.getSelection(),b=b?0:1;null!==e&&(d.selectNodeContents(a),e.addRange(d),e.collapse(a,b));this.focus()},insertNodeAtCaret:function(a){if("undefined"!==typeof window.getSelection){var b=this.getSelection();if(b.rangeCount){var d=b.getRangeAt(0);d.collapse(!1);d.insertNode(a);d=d.cloneRange();d.selectNodeContents(a);d.collapse(!1);b.removeAllRanges();b.addRange(d)}}else"undefined"!==typeof document.selection&&"Control"!==document.selection.type&&(b=1===a.nodeType?a.outerHTML:a.data,d="marker_"+
(""+Math.random()).slice(2),b+='<span id="'+d+'"></span>',a=this.getSelection(),a.collapse(!1),a.pasteHTML(b),b=document.getElementById(d),a.moveToElementText(b),a.select(),b.parentNode.removeChild(b))},getBtn:function(a){return b(this.$toolbar.find("a.redactor_btn_"+a))},setBtnActive:function(a){this.getBtn(a).addClass("act")},setBtnInactive:function(a){this.getBtn(a).removeClass("act")},changeBtnIcon:function(a,b){this.getBtn(a).addClass("redactor_btn_"+b)},removeBtnIcon:function(a,b){this.getBtn(a).removeClass("redactor_btn_"+
b)},removeBtn:function(a){this.getBtn(a).remove()},addBtn:function(a,c){this.$toolbar.append(b("<li>").append(this.buildButton(a,c)))},fullscreen:function(){var a;!1===this.opts.fullscreen?(this.changeBtnIcon("fullscreen","normalscreen"),this.setBtnActive("fullscreen"),this.opts.fullscreen=!0,this.height=this.$frame.css("height"),this.width=this.$box.width()-2+"px",a=this.getCode(),this.tmpspan=b("<span></span>"),this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan),b(document.body).prepend(this.$box).css("overflow",
"hidden"),this.$editor=this.enable(a),b(this.doc).click(b.proxy(this.hideAllDropDown,this)),this.observeFocus(),this.observeImages(),this.observeTables(),this.$box.find(".redactor_resizer").hide(),this.fullScreenResize(),b(window).resize(b.proxy(this.fullScreenResize,this)),b(document).scrollTop(0,0)):(this.removeBtnIcon("fullscreen","normalscreen"),this.setBtnInactive("fullscreen"),this.opts.fullscreen=!1,b(window).unbind("resize",b.proxy(this.fullScreenResize,this)),b(document.body).css("overflow",
""),a=this.getCode(),this.$box.removeClass("redactor_box_fullscreen").css("width","auto"),this.tmpspan.after(this.$box).remove(),this.$editor=this.enable(a),this.observeImages(),this.observeTables(),this.opts.autoresize&&this.observeAutoResize(),this.$box.find(".redactor_resizer").show(),b(this.doc).click(b.proxy(this.hideAllDropDown,this)),this.observeFocus(),this.syncCode(),this.$frame.css("height",this.height),this.$el.css("height",this.height));this.focus()},fullScreenResize:function(){if(!1===
this.opts.fullscreen)return!1;var a=b(window).height()-42;this.$box.width(b(window).width()-2);this.$frame.height(a);this.$el.height(a)},buildResizer:function(){if(!1===this.opts.resize)return!1;this.$resizer=b('<div class="redactor_resizer">&mdash;</div>');this.$box.append(this.$resizer);this.$resizer.mousedown(b.proxy(this.initResize,this))},initResize:function(a){a.preventDefault&&a.preventDefault();this.splitter=a.target;this.opts.visual?(this.element_resize=this.$frame,this.element_resize.get(0).style.visibility=
"hidden",this.element_resize_parent=this.$el):(this.element_resize=this.$el,this.element_resize_parent=this.$frame);this.stopResizeHdl=b.proxy(this.stopResize,this);this.startResizeHdl=b.proxy(this.startResize,this);this.resizeHdl=b.proxy(this.resize,this);b(document).mousedown(this.startResizeHdl);b(document).mouseup(this.stopResizeHdl);b(this.splitter).mouseup(this.stopResizeHdl);this.h_new=this.null_point=!1;this.h=this.element_resize.height()},startResize:function(){b(document).mousemove(this.resizeHdl)},
resize:function(a){a.preventDefault&&a.preventDefault();a=a.pageY;!1===this.null_point&&(this.null_point=a);!1===this.h_new&&(this.h_new=this.element_resize.height());a=this.h_new+a-this.null_point-10;if(30>=a)return!0;0<=a&&(this.element_resize.get(0).style.height=a+"px",this.element_resize_parent.get(0).style.height=a+"px")},stopResize:function(){b(document).unbind("mousemove",this.resizeHdl);b(document).unbind("mousedown",this.startResizeHdl);b(document).unbind("mouseup",this.stopResizeHdl);b(this.splitter).unbind("mouseup",
this.stopResizeHdl);this.element_resize.get(0).style.visibility="visible"},resizeImage:function(a){var c=!1,d=!1,e,f=b(a).width()/b(a).height();b(a).hover(function(){b(a).css("cursor","nw-resize")},function(){b(a).css("cursor","default");c=!1});b(a).mousedown(function(f){f.preventDefault&&f.preventDefault();d=c=!0;Math.round(f.pageX-b(a).eq(0).offset().left);e=Math.round(f.pageY-b(a).eq(0).offset().top)});b(a).mouseup(b.proxy(function(){c=!1;this.syncCode();!0===this.opts.autoresize&&this.setAutoSize(!1)},
this));b(a).click(b.proxy(function(a){d&&this.imageEdit(a)},this));b(a).mousemove(function(g){if(c){d=!1;Math.round(g.pageX-b(this).eq(0).offset().left);var h=Math.round(g.pageY-b(this).eq(0).offset().top)-e,j=b(a).height(),h=parseInt(j,10)+h,j=h*f;b(a).width(j);b(a).height(h);Math.round(g.pageX-b(this).eq(0).offset().left);e=Math.round(g.pageY-b(this).eq(0).offset().top)}})},showTable:function(){this.modalInit(RLANG.table,"table",300,b.proxy(function(){b("#redactor_insert_table_btn").click(b.proxy(this.insertTable,
this))},this),function(){b("#redactor_table_rows").focus()})},insertTable:function(){for(var a=b("#redactor_table_rows").val(),c=b("#redactor_table_columns").val(),d=b("<div></div>"),e=Math.floor(99999*Math.random()),f=b('<table id="table'+e+'"><tbody></tbody></table>'),g=0;g<a;g++){for(var h=b("<tr></tr>"),j=0;j<c;j++){var i=b("<td>&nbsp;</td>");b(h).append(i)}b(f).append(h)}b(d).append(f);a=b(d).html();a=b.browser.msie?a+"<p></p>":a+"<p>&nbsp;</p>";this.execCommand("inserthtml",a);this.modalClose();
this.$table=b(this.doc).find("body").find("#table"+e);this.$table.click(b.proxy(this.tableObserver,this));!0===this.opts.autoresize&&this.setAutoSize(!1)},tableObserver:function(a){this.$table=b(a.target).parents("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$table_td.removeClass("current");this.$tbody=b(a.target).parents("tbody");this.$thead=b(this.$table).find("thead");this.$current_td=b(a.target);this.$current_td.addClass("current");this.$current_tr=
b(a.target).parents("tr")},deleteTable:function(){b(this.$table).remove();this.$table=!1;this.syncCode()},deleteRow:function(){b(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var a=b(this.$current_td).get(0).cellIndex;b(this.$table).find("tr").each(function(){b(this).find("td").eq(a).remove()});this.syncCode()},addHead:function(){if(0!==b(this.$table).find("thead").size())this.deleteHead();else{var a=b(this.$table).find("tr").first().clone();a.find("td").html("&nbsp;");this.$thead=
b("<thead></thead>");this.$thead.append(a);b(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){b(this.$thead).remove();this.$thead=!1;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(a){var c=b(this.$current_tr).clone();c.find("td").html("&nbsp;");"after"===a?b(this.$current_tr).after(c):
b(this.$current_tr).before(c);this.syncCode()},insertColumn:function(a){var c=0;this.$current_td.addClass("current");this.$current_tr.find("td").each(function(a,e){b(e).hasClass("current")&&(c=a)});this.$table_tr.each(function(d,e){var f=b(e).find("td").eq(c),g=f.clone();g.html("&nbsp;");"after"===a?b(f).after(g):b(f).before(g)});this.syncCode()},showVideo:function(){b.browser.msie&&this.markerIE();this.modalInit(RLANG.video,"video",600,b.proxy(function(){b("#redactor_insert_video_btn").click(b.proxy(this.insertVideo,
this))},this),function(){b("#redactor_insert_video_area").focus()})},insertVideo:function(){var a=b("#redactor_insert_video_area").val(),a=this.stripTags(a);b.browser.msie?(b(this.doc.getElementById("span"+this.spanid)).after(a).remove(),this.syncCode()):this.execCommand("inserthtml",a);this.modalClose();!0===this.opts.autoresize&&this.setAutoSize(!1)},imageEdit:function(a){var c=b(a.target),d=c.parent(),a=b.proxy(function(){b("#redactor_file_alt").val(c.attr("alt"));b("#redactor_image_edit_src").attr("href",
c.attr("src"));b("#redactor_form_image_align").val(c.css("float"));"A"===b(d).get(0).tagName&&b("#redactor_file_link").val(b(d).attr("href"));b("#redactor_image_delete_btn").click(b.proxy(function(){this.imageDelete(c)},this));b("#redactorSaveBtn").click(b.proxy(function(){this.imageSave(c)},this))},this);this.modalInit(RLANG.image,"image_edit",380,a)},imageDelete:function(a){b(a).remove();this.modalClose();this.syncCode();!0===this.opts.autoresize&&this.setAutoSize(!1)},imageSave:function(a){var c=
b(a).parent();b(a).attr("alt",b("#redactor_file_alt").val());var d=b("#redactor_form_image_align").val();"left"===d?b(a).css({"float":"left",margin:"0 10px 10px 0"}):"right"===d?b(a).css({"float":"right",margin:"0 0 10px 10px"}):b(a).css({"float":"none",margin:"0"});d=b.trim(b("#redactor_file_link").val());""!==d?"A"!==b(c).get(0).tagName?b(a).replaceWith('<a href="'+d+'">'+this.outerHTML(a)+"</a>"):b(c).attr("href",d):"A"===b(c).get(0).tagName&&b(c).replaceWith(this.outerHTML(a));this.modalClose();
this.observeImages();this.syncCode()},showImage:function(){b.browser.msie&&this.markerIE();var a=b.proxy(function(){!1!==this.opts.imageGetJson?b.getJSON(this.opts.imageGetJson,b.proxy(function(a){b.each(a,b.proxy(function(a,c){var d=b('<img src="'+c.thumb+'" rel="'+c.image+'" />');b("#redactor_image_box").append(d);b(d).click(b.proxy(this.imageSetThumb,this))},this))},this)):b("#redactor_tabs a").eq(1).remove();if(!1!==this.opts.imageUpload)!1===this.isMobile()&&0!==b("#redactor_file").size()&&b("#redactor_file").dragupload({url:this.opts.imageUpload,
success:b.proxy(this.imageUploadCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:b.proxy(this.imageUploadCallback,this)});else if(b(".redactor_tab").hide(),!1===this.opts.imageGetJson)b("#redactor_tabs").remove(),b("#redactor_tab3").show();else{var a=b("#redactor_tabs a");a.eq(0).remove();a.eq(1).addClass("redactor_tabs_act");b("#redactor_tab2").show()}b("#redactor_upload_btn").click(b.proxy(this.imageUploadCallbackLink,this))},this),c=b.proxy(function(){!1===
this.opts.imageUpload&&!1===this.opts.imageGetJson&&b("#redactor_file_link").focus()},this);this.modalInit(RLANG.image,"image",570,a,c,!0)},imageSetThumb:function(a){this._imageSet('<img alt="" src="'+b(a.target).attr("rel")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==b("#redactor_file_link").val()){var a='<img src="'+b("#redactor_file_link").val()+'" />';this._imageSet(a,!0)}else this.modalClose()},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(a,c){var d="",e="";
!0!==c?(e=b.parseJSON(a),d='<p><img src="'+e.filelink+'" /></p>'):d=a;this.focus();b.browser.msie?(b(this.doc.getElementById("span"+this.spanid)).after(d).remove(),this.syncCode()):this.execCommand("inserthtml",d);!0!==c&&"function"===typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,e);this.modalClose();b(this.doc).find("img").load(b.proxy(function(){this.setAutoSize(!1)},this));this.observeImages()},showLink:function(){var a=b.proxy(function(){var a=this.getSelection(),d=
"",e="";b.browser.msie?(e=this.getParentNode(),"A"===e.nodeName?(this.insert_link_node=b(e),e=this.insert_link_node.text(),d=this.insert_link_node.attr("href")):(e=this.oldIE()?a.text:a.toString(),this.spanid=Math.floor(99999*Math.random()),a='<span id="span'+this.spanid+'">'+e+"</span>",""!==e&&(a='<span id="span'+this.spanid+'">'+e+"</span>"),this.execCommand("inserthtml",a))):a&&a.anchorNode&&"A"===a.anchorNode.parentNode.tagName?(d=a.anchorNode.parentNode.href,e=a.anchorNode.parentNode.text,""===
a.toString()&&(this.insert_link_node=a.anchorNode.parentNode)):(e=a.toString(),d="");b(".redactor_link_text").val(e);a=d.replace(top.location.href,"");0===d.search("mailto:")?(this.setModalTab(2),b("#redactor_tab_selected").val(2),b("#redactor_link_mailto").val(d.replace("mailto:",""))):0===a.search(/^#/gi)?(this.setModalTab(3),b("#redactor_tab_selected").val(3),b("#redactor_link_anchor").val(a.replace(/^#/gi,""))):b("#redactor_link_url").val(d);b("#redactor_insert_link_btn").click(b.proxy(this.insertLink,
this))},this);this.modalInit(RLANG.link,"link",460,a,function(){b("#redactor_link_url").focus()})},insertLink:function(){var a=b("#redactor_tab_selected").val(),c="",d="";"1"===a?(c=b("#redactor_link_url").val(),d=b("#redactor_link_url_text").val()):"2"===a?(c="mailto:"+b("#redactor_link_mailto").val(),d=b("#redactor_link_mailto_text").val()):"3"===a&&(c="#"+b("#redactor_link_anchor").val(),d=b("#redactor_link_anchor_text").val());this._insertLink('<a href="'+c+'">'+d+"</a> ",b.trim(d),c)},_insertLink:function(a,
c,d){""!=c&&(this.insert_link_node?(b(this.insert_link_node).text(c),b(this.insert_link_node).attr("href",d),this.syncCode()):b.browser.msie?(b(this.doc.getElementById("span"+this.spanid)).replaceWith(a),this.syncCode()):this.execCommand("inserthtml",a));this.modalClose()},showFile:function(){b.browser.msie&&this.markerIE();var a=b.proxy(function(){var a=this.getSelection(),d="",d=this.oldIE()?a.text:a.toString();b("#redactor_filename").val(d);!1===this.isMobile()&&b("#redactor_file").dragupload({url:this.opts.fileUpload,
success:b.proxy(function(a){this.fileUploadCallback(a)},this)});this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:b.proxy(function(a){this.fileUploadCallback(a)},this)})},this);this.modalInit(RLANG.file,"file",500,a)},fileUploadCallback:function(a){var a=b.parseJSON(a),c=b("#redactor_filename").val();""===c&&(c=a.filename);var d='<a href="'+a.filelink+'">'+c+"</a>";b.browser.webkit&&window.chrome&&(d+="&nbsp;");b.browser.msie?(""!==c?b(this.doc.getElementById("span"+this.spanid)).replaceWith(d):
b(this.doc.getElementById("span"+this.spanid)).after(d).remove(),this.syncCode()):this.execCommand("inserthtml",d);"function"===typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,a);this.modalClose()},modalInit:function(a,c,d,e,f,g){0===b("#redactor_modal_overlay").size()&&(this.overlay=b('<div id="redactor_modal_overlay" style="display: none;"></div>'),b("body").prepend(this.overlay));this.opts.overlay&&(b("#redactor_modal_overlay").show(),b("#redactor_modal_overlay").click(b.proxy(this.modalClose,
this)));0===b("#redactor_modal").size()&&(this.modal=b('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),b("body").append(this.modal));b("#redactor_modal_close").click(b.proxy(this.modalClose,this));this.hdlModalClose=b.proxy(function(a){27===a.keyCode&&this.modalClose()},this);b(document).keyup(this.hdlModalClose);b(this.doc).keyup(this.hdlModalClose);b("#redactor_modal_inner").html(this.opts["modal_"+
c]);b("#redactor_modal_header").html(a);if(0!==b("#redactor_tabs").size()){var h=this;b("#redactor_tabs a").each(function(a,c){a++;b(c).click(function(){b("#redactor_tabs a").removeClass("redactor_tabs_act");b(this).addClass("redactor_tabs_act");b(".redactor_tab").hide();b("#redactor_tab"+a).show();b("#redactor_tab_selected").val(a);if(!1===h.isMobile()){var c=b("#redactor_modal").outerHeight();b("#redactor_modal").css("margin-top","-"+(c+10)/2+"px")}})})}b("#redactor_btn_modal_close").click(b.proxy(this.modalClose,
this));"function"===typeof e&&e();a=b("#redactor_modal").outerHeight();!1===this.isMobile()?b("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:d+"px",height:"auto",marginTop:"-"+(a+10)/2+"px",marginLeft:"-"+(d+60)/2+"px"}).fadeIn("fast"):(b("#redactor_modal").css({position:"absolute",width:"96%",height:"auto",top:"20px",left:"0",marginTop:"0px",marginLeft:"2%"}).show(),this.scrolltop());"function"===typeof f&&f();!0===g&&b("#redactor_image_box").height(300).css("overflow","auto")},
modalClose:function(){b("#redactor_modal_close").unbind("click",this.modalClose);b("#redactor_modal").fadeOut("fast",b.proxy(function(){b("#redactor_modal_inner").html("");this.opts.overlay&&(b("#redactor_modal_overlay").hide(),b("#redactor_modal_overlay").unbind("click",this.modalClose));b(document).unbind("keyup",this.hdlModalClose);b(this.doc).unbind("keyup",this.hdlModalClose)},this))},setModalTab:function(a){b(".redactor_tab").hide();var c=b("#redactor_tabs a");c.removeClass("redactor_tabs_act");
c.eq(a-1).addClass("redactor_tabs_act");b("#redactor_tab"+a).show()},uploadInit:function(a,c){this.uploadOptions={url:!1,success:!1,start:!1,trigger:!1,auto:!1,input:!1};b.extend(this.uploadOptions,c);0!==b("#"+a).size()&&"INPUT"===b("#"+a).get(0).tagName?(this.uploadOptions.input=b("#"+a),this.element=b(b("#"+a).get(0).form)):this.element=b("#"+a);this.element_action=this.element.attr("action");this.uploadOptions.auto?b(this.uploadOptions.input).change(b.proxy(function(){this.element.submit(function(){return!1});
this.uploadSubmit()},this)):this.uploadOptions.trigger&&b("#"+this.uploadOptions.trigger).click(b.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var a=document.createElement("div");a.innerHTML='<iframe style="display:none" src="about:blank" id="'+this.id+'" name="'+this.id+'"></iframe>';document.body.appendChild(a);this.uploadOptions.start&&this.uploadOptions.start();b("#"+
this.id).load(b.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(a,c){if(this.uploadOptions.input){var d="redactorUploadForm"+this.id,e="redactorUploadFile"+this.id;this.form=b('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+c+'" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');var d=this.uploadOptions.input,f=b(d).clone();b(d).attr("id",e);b(d).before(f);b(d).appendTo(this.form);b(this.form).css("position","absolute");b(this.form).css("top","-2000px");
b(this.form).css("left","-2000px");b(this.form).appendTo("body");this.form.submit()}else a.attr("target",c),a.attr("method","POST"),a.attr("enctype","multipart/form-data"),a.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var a=b("#"+this.id),a=a.contentDocument?a.contentDocument:a.contentWindow?a.contentWindow.document:window.frames[this.id].document;if("about:blank"===a.location.href)return!0;this.uploadOptions.success&&(a=a.body.innerHTML.match(/\{.*\}/)[0],
this.uploadOptions.success(a));this.element.attr("action",this.element_action);this.element.attr("target","")},markerIE:function(){this.spanid=Math.floor(99999*Math.random());this.execCommand("inserthtml",'<span id="span'+this.spanid+'"></span>')},oldIE:function(){return b.browser.msie&&9>parseInt(b.browser.version,10)?!0:!1},outerHTML:function(a){return b("<p>").append(b(a).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",""),10)},isMobile:function(){return/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?
!0:!1},scrolltop:function(){b("html,body").animate({scrollTop:0},500)}};b.fn.getDoc=function(){return b(this.data("redactor").doc)};b.fn.getFrame=function(){return this.data("redactor").$frame};b.fn.getEditor=function(){return this.data("redactor").$editor};b.fn.getCode=function(){return this.data("redactor").getCode()};b.fn.getText=function(){return this.data("redactor").$editor.text()};b.fn.setCode=function(a){this.data("redactor").setCode(a)};b.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)};
b.fn.destroyEditor=function(){this.data("redactor").destroy();this.removeData("redactor")};b.fn.setFocus=function(){this.data("redactor").focus()};b.fn.execCommand=function(a,b){this.data("redactor").execCommand(a,b)}})(jQuery);
(function(b){function i(a,c){this.opts=b.extend({url:!1,success:!1,preview:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},c);this.$el=b(a)}b.fn.dragupload=function(a){return this.each(function(){(new i(this,a)).init()})};i.prototype={init:function(){if(!b.browser.opera&&!b.browser.msie){this.droparea=b('<div class="redactor_droparea"></div>');this.dropareabox=b('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=b('<div class="redactor_dropalternative">'+this.opts.atext+
"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",b.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",b.proxy(function(){return this.ondragleave()},this));var a=b.proxy(function(a){a=parseInt(100*(a.loaded/a.total),10);this.dropareabox.text("Loading "+a+"%")},this),c=jQuery.ajaxSettings.xhr();c.upload&&c.upload.addEventListener("progress",a,!1);var d=function(){return c};
this.dropareabox.get(0).ondrop=b.proxy(function(a){a.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");var a=a.dataTransfer.files[0],c=new FormData;c.append("file",a);b.ajax({dataType:"html",url:this.opts.url,data:c,xhr:d,cache:!1,contentType:!1,processData:!1,type:"POST",success:b.proxy(function(a){!1!==this.opts.success&&this.opts.success(a);!0===this.opts.preview&&this.dropareabox.html(a)},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return!1},ondragleave:function(){this.dropareabox.removeClass("hover");
return!1}}})(jQuery);
(function(b){var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,a=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,c=function(){for(var d=this.childNodes,e=d.length;e--;){var f=d[e];if(3===f.nodeType){var g=f.nodeValue;g&&(g=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="http://$2">$2</a>$3').replace(a,'$1<a href="$2">$2</a>$5'),b(f).after(g).remove())}else 1===f.nodeType&&!/^(a|button|textarea)$/i.test(f.tagName)&&c.call(f)}};b.fn.linkify=function(){this.each(c)}})(jQuery);